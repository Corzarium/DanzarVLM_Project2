2025-05-27 19:44:21,953 ConfigLoader INFO: Successfully loaded global settings from /home/corzarium/DanzarVLM_Project/config/global_settings.yaml
2025-05-27 19:44:21,955 - DanzarVLM - INFO - --- Starting DanzarVLM (Profile Arg: everquest, Effective LogLevel: INFO) ---
2025-05-27 19:44:21,956 ConfigLoader INFO: Available profiles: ['generic_game', 'rimworld', 'everquest']
2025-05-27 19:44:21,956 - DanzarVLM - INFO - Available game profiles: ['generic_game', 'rimworld', 'everquest']
2025-05-27 19:44:21,970 ConfigLoader INFO: Loaded GameProfile for 'everquest' from /home/corzarium/DanzarVLM_Project/config/profiles/everquest.yaml
2025-05-27 19:44:21,971 - DanzarVLM - INFO - Successfully loaded game profile: everquest
2025-05-27 19:44:21,971 - DanzarVLM - INFO - [AppContext] Initialized.
2025-05-27 19:44:21,971 - DanzarVLM - INFO - Initializing services...
2025-05-27 19:44:21,976 - DanzarVLM - INFO - [MemoryService] Memory database initialized at /home/corzarium/DanzarVLM_Project/data/memory.db
2025-05-27 19:44:21,976 - DanzarVLM - INFO - [MemoryService] Initialized.
2025-05-27 19:44:21,976 - DanzarVLM - INFO - [AudioService] Instance created.
2025-05-27 19:44:21,976 - DanzarVLM - INFO - [AudioService] Initializing audio systems (OWW, STT)...
2025-05-27 19:44:21,976 - DanzarVLM - INFO - [AudioService] Attempting to load OWW model from: /home/corzarium/models/Danzar.tflite
INFO: Created TensorFlow Lite XNNPACK delegate for CPU.
2025-05-27 19:44:22,215 - DanzarVLM - INFO - [AudioService] OWW model loaded successfully from /home/corzarium/models/Danzar.tflite. Active model key for prediction checks: 'Danzar'
2025-05-27 19:44:22,216 - DanzarVLM - INFO - [AudioService] Attempting to load Whisper STT model: base.en
2025-05-27 19:44:48,923 - DanzarVLM - INFO - [AudioService] Whisper STT model 'base.en' loaded successfully.
2025-05-27 19:44:48,923 - DanzarVLM - INFO - [AudioService] Audio systems initialization attempt complete.
2025-05-27 19:44:48,923 - DanzarVLM - INFO - [RAGService] Initialized. RAG Server URL: http://172.17.117.23:5000, Server Default Collection: 'multimodal_rag'
2025-05-27 19:44:48,924 - DanzarVLM - INFO - [OCRProcessor] Initializing EasyOCR Reader. Languages: ['en'], GPU: True
2025-05-27 19:44:51,524 - DanzarVLM - INFO - [OCRProcessor] EasyOCR Reader initialized successfully.
2025-05-27 19:44:51,524 - DanzarVLM - INFO - [OCRProcessor] Attempting to load OCR layout. Path from profile: 'config/ui_layouts/everquest_ocr_layout.json'
2025-05-27 19:44:51,524 - DanzarVLM - INFO - [OCRProcessor] Resolved OCR layout path to: '/home/corzarium/DanzarVLM_Project/config/ui_layouts/everquest_ocr_layout.json'
2025-05-27 19:44:51,525 - DanzarVLM - WARNING - [OCRProcessor] OCR layout file NOT FOUND at resolved path: /home/corzarium/DanzarVLM_Project/config/ui_layouts/everquest_ocr_layout.json
2025-05-27 19:44:51,525 - DanzarVLM - WARNING - [OCRProcessor] Ensure ocr_layout_path in profile is correct and relative to project execution dir, or an absolute path.
2025-05-27 19:44:51,526 - DanzarVLM - WARNING - [OCRProcessor] CONFIRMED: ocr_layout_rois is EMPTY. This will result in slow full-image OCR for VLM commentary.
2025-05-27 19:44:51,526 - DanzarVLM - INFO - [OCRProcessor] Initialized.
2025-05-27 19:44:51,526 - DanzarVLM - INFO - [LLMService] OCRProcessor initialized successfully.
2025-05-27 19:44:51,526 - DanzarVLM - INFO - [LLMService] Initial VLM commentary delay set to: 69.82s
2025-05-27 19:44:51,534 - DanzarVLM - INFO - [MemoryService] Memory database initialized at /home/corzarium/DanzarVLM_Project/data/memory.db
2025-05-27 19:44:51,534 - DanzarVLM - INFO - [MemoryService] Initialized.
2025-05-27 19:44:51,534 - DanzarVLM - INFO - [LLMService] MemoryService initialized successfully.
2025-05-27 19:44:51,534 - DanzarVLM - INFO - [LLMService] Initialized.
2025-05-27 19:44:51,535 - DanzarVLM - INFO - [NDIService] Instance created.
2025-05-27 19:44:51,535 - DanzarVLM - INFO - [NDIService] Trying to initialize NDI...
2025-05-27 19:44:51,535 - DanzarVLM - INFO - [NDIService] Attempting to load NDI library: PyNDI4
2025-05-27 19:44:51,536 - DanzarVLM - WARNING - [NDIService] Could not import NDI library: PyNDI4
2025-05-27 19:44:51,536 - DanzarVLM - INFO - [NDIService] Attempting to load NDI library: ndi
2025-05-27 19:44:51,536 - DanzarVLM - WARNING - [NDIService] Could not import NDI library: ndi
2025-05-27 19:44:51,536 - DanzarVLM - INFO - [NDIService] Attempting to load NDI library: NDIlib
2025-05-27 19:44:51,536 - DanzarVLM - ERROR - [NDIService] Error initializing NDI with NDIlib: 'NDIService' object has no attribute '_init_ndilib'
Traceback (most recent call last):
  File "/home/corzarium/DanzarVLM_Project/services/ndi_service.py", line 58, in _initialize_ndi
    self._init_ndilib(ndi)
AttributeError: 'NDIService' object has no attribute '_init_ndilib'
2025-05-27 19:44:51,537 - DanzarVLM - ERROR - [NDIService] Failed to initialize NDI using any available library.
2025-05-27 19:44:51,537 - DanzarVLM - INFO - [NDIService] Initialized.
2025-05-27 19:44:51,539 - DanzarVLM - INFO - All services instantiated.
2025-05-27 19:44:51,540 - DanzarVLM - INFO - Web interface available at http://0.0.0.0:8888
2025-05-27 19:44:51,540 - DanzarVLM - INFO - Web interface started on port 8888
2025-05-27 19:44:51,540 - DanzarVLM - INFO - [NDIService] Initializing NDI library and connection...
2025-05-27 19:44:51,540 - DanzarVLM - INFO - Started thread: NDIServiceThread
2025-05-27 19:44:51,556 - DanzarVLM - INFO - [LLMService] Starting VLM commentary loop.
2025-05-27 19:44:51,556 - DanzarVLM - INFO - [NDIService] Discovering NDI sources (timeout 5000ms)...
2025-05-27 19:44:51,557 - DanzarVLM - INFO - Started thread: VLMCommentaryThread
2025-05-27 19:44:51,568 - DanzarVLM - INFO - [NDIService] Available NDI sources:
2025-05-27 19:44:51,569 - DanzarVLM - INFO - [DiscordBot] Starting Discord bot client...
2025-05-27 19:44:51,569 - DanzarVLM - INFO - Started thread: DiscordBotThread
2025-05-27 19:44:51,570 - DanzarVLM - INFO -   0: CENTERAILUM-AI (OBS) (URL: 172.17.112.1:5961)
2025-05-27 19:44:51,574 - DanzarVLM - INFO - [DiscordBot] Starting TTS/Text Playback Loop.
2025-05-27 19:44:51,574 - DanzarVLM - INFO - Started thread: DiscordPlaybackThread
2025-05-27 19:44:51,575 - DanzarVLM - INFO - [NDIService] Attempting to connect to NDI source: CENTERAILUM-AI (OBS)
2025-05-27 19:44:51,576 - DanzarVLM - INFO - NDI commentary started as disabled.
2025-05-27 19:44:51,581 - DanzarVLM - INFO - [NDIService] Successfully connected to NDI source: CENTERAILUM-AI (OBS)
2025-05-27 19:44:51,585 - DanzarVLM - INFO - DanzarVLM core setup complete. Profile: everquest. Main loop running. Press Ctrl+C to exit.
2025-05-27 19:44:51,586 - DanzarVLM - INFO - [NDIService] Starting NDI frame capture loop...
2025-05-27 19:44:51,603 - DanzarVLM - INFO - [NDIService] Received NDI FRANE_TYPE_STATUS_CHANGE frame.
 * Serving Flask app 'web.server'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8888
 * Running on http://172.17.117.23:8888
Press CTRL+C to quit
2025-05-27 19:44:54,529 - DanzarVLM - INFO - [DiscordBot] Logged in as DanzarAI (ID: 1363389807027294258)
2025-05-27 19:44:54,529 - DanzarVLM - INFO - Attempting to connect to VC: 'General'
2025-05-27 19:44:55,052 - DanzarVLM - INFO - Successfully connected to 'General'.
2025-05-27 19:44:55,052 - DanzarVLM - INFO - [DiscordBot] Attempting to start recording in 'General'.
2025-05-27 19:44:55,104 - DanzarVLM - INFO - [DanzarAudioSink] Instance created, linked.
2025-05-27 19:44:55,106 - DanzarVLM - INFO - [DiscordBot] Recording started in 'General'.
2025-05-27 19:45:51,597 - DanzarVLM - INFO - [NDIService] Capture loop still alive and running...
2025-05-27 19:46:13,594 - DanzarVLM - INFO - [DiscordBot] Forwarding Danzar query to LLM from corzarium: 'Are you ready to search the internet now?'
2025-05-27 19:46:13,594 - DanzarVLM - INFO - [LLMService] User query from 'corzarium': "Are you ready to search the internet now?"
2025-05-27 19:46:13,612 - DanzarVLM - INFO - [RAGService] Ingesting text to RAG server: 'User (corzarium): Are you ready to search the internet now?...' (Target Collection on Server: 'danzarvlm_everquest_history')
2025-05-27 19:46:13,614 - DanzarVLM - INFO - !!!! EXACT PAYLOAD TO RAG SERVER (http://172.17.117.23:5000/add): {
  "text": "User (corzarium): Are you ready to search the internet now?",
  "metadata": {
    "user": "corzarium",
    "game": "everquest",
    "type": "user_input",
    "source": "user_query",
    "timestamp": 1748393173.59496,
    "importance_score": 1.0
  }
} !!!!
2025-05-27 19:46:13,942 - DanzarVLM - INFO - [RAGService] Querying RAG server: Collection 'multimodal_rag_default', TopK 5, Query 'Are you ready to search the internet now?...'
2025-05-27 19:46:13,943 - DanzarVLM - INFO - !!!! EXACT PAYLOAD TO RAG SERVER (http://172.17.117.23:5000/query): {
  "query_text": "Are you ready to search the internet now?",
  "n_results": 5,
  "collection_name": "multimodal_rag_default"
} !!!!
2025-05-27 19:46:13,994 - DanzarVLM - INFO - [RAGService] RAG server query for 'Are you ready to search the in...' returned 5 source documents.
2025-05-27 19:46:13,995 - DanzarVLM.FactCheck - ERROR - RAG query failed: ModelClient.generate() got an unexpected keyword argument 'prompt'
Traceback (most recent call last):
  File "/home/corzarium/DanzarVLM_Project/services/danzar_factcheck.py", line 109, in fact_checked_generate
    response = self.model_client.generate(
TypeError: ModelClient.generate() got an unexpected keyword argument 'prompt'
2025-05-27 19:46:13,995 - DanzarVLM.FactCheck - INFO - Attempting web search for additional context...
2025-05-27 19:46:14,333 - DanzarVLM - INFO - [RAGService] Ingesting text to RAG server: 'AI (DanzarVLM): I apologize, but I'm unable to find any rele...' (Target Collection on Server: 'danzarvlm_everquest_history')
2025-05-27 19:46:14,334 - DanzarVLM - INFO - !!!! EXACT PAYLOAD TO RAG SERVER (http://172.17.117.23:5000/add): {
  "text": "AI (DanzarVLM): I apologize, but I'm unable to find any relevant information about that topic. Would you like to try a different question?",
  "metadata": {
    "user_query": "Are you ready to search the internet now?",
    "user": "corzarium",
    "game": "everquest",
    "type": "bot_response",
    "llm_model": "mistral",
    "source": "bot_response",
    "timestamp": 1748393174.3257759,
    "importance_score": 1.0
  }
} !!!!
2025-05-27 19:46:14,397 - DanzarVLM - INFO - [AudioService] Requesting TTS for: 'I apologize, but I'm unable to find any relevant i...' from http://172.17.117.23:1235/tts
2025-05-27 19:46:16,176 - DanzarVLM - INFO - [AudioService] TTS audio received (length: 398380 bytes).
2025-05-27 19:46:16,176 - DanzarVLM - INFO - Conversational response sent to queue: "I apologize, but I'm unable to find any relevant information about that topic. Would you like to try..."
[aist#0:0/pcm_s16le @ 0x5603fee10600] Guessed Channel Layout: mono
2025-05-27 19:46:34,295 - DanzarVLM - INFO - [DiscordBot] Forwarding Danzar query to LLM from corzarium: 'Can you look up what the hotzone is for level 45 in Everquest?'
2025-05-27 19:46:34,296 - DanzarVLM - INFO - [LLMService] User query from 'corzarium': "Can you look up what the hotzone is for level 45 in Everquest?"
2025-05-27 19:46:34,326 - DanzarVLM - INFO - [RAGService] Ingesting text to RAG server: 'User (corzarium): Can you look up what the hotzone is for le...' (Target Collection on Server: 'danzarvlm_everquest_history')
2025-05-27 19:46:34,327 - DanzarVLM - INFO - !!!! EXACT PAYLOAD TO RAG SERVER (http://172.17.117.23:5000/add): {
  "text": "User (corzarium): Can you look up what the hotzone is for level 45 in Everquest?",
  "metadata": {
    "user": "corzarium",
    "game": "everquest",
    "type": "user_input",
    "source": "user_query",
    "timestamp": 1748393194.296307,
    "importance_score": 1.0
  }
} !!!!
2025-05-27 19:46:34,386 - DanzarVLM - INFO - [RAGService] Querying RAG server: Collection 'multimodal_rag_default', TopK 5, Query 'Can you look up what the hotzone is for level 45 i...'
2025-05-27 19:46:34,387 - DanzarVLM - INFO - !!!! EXACT PAYLOAD TO RAG SERVER (http://172.17.117.23:5000/query): {
  "query_text": "Can you look up what the hotzone is for level 45 in Everquest?",
  "n_results": 5,
  "collection_name": "multimodal_rag_default"
} !!!!
2025-05-27 19:46:34,434 - DanzarVLM - INFO - [RAGService] RAG server query for 'Can you look up what the hotzo...' returned 5 source documents.
2025-05-27 19:46:34,434 - DanzarVLM.FactCheck - ERROR - RAG query failed: ModelClient.generate() got an unexpected keyword argument 'prompt'
Traceback (most recent call last):
  File "/home/corzarium/DanzarVLM_Project/services/danzar_factcheck.py", line 109, in fact_checked_generate
    response = self.model_client.generate(
TypeError: ModelClient.generate() got an unexpected keyword argument 'prompt'
2025-05-27 19:46:34,434 - DanzarVLM.FactCheck - INFO - Attempting web search for additional context...
2025-05-27 19:46:34,710 - DanzarVLM - INFO - [RAGService] Ingesting text to RAG server: 'AI (DanzarVLM): I apologize, but I'm unable to find any rele...' (Target Collection on Server: 'danzarvlm_everquest_history')
2025-05-27 19:46:34,711 - DanzarVLM - INFO - !!!! EXACT PAYLOAD TO RAG SERVER (http://172.17.117.23:5000/add): {
  "text": "AI (DanzarVLM): I apologize, but I'm unable to find any relevant information about that topic. Would you like to try a different question?",
  "metadata": {
    "user_query": "Can you look up what the hotzone is for level 45 in Everquest?",
    "user": "corzarium",
    "game": "everquest",
    "type": "bot_response",
    "llm_model": "mistral",
    "source": "bot_response",
    "timestamp": 1748393194.687716,
    "importance_score": 1.0
  }
} !!!!
2025-05-27 19:46:34,804 - DanzarVLM - INFO - [AudioService] Requesting TTS for: 'I apologize, but I'm unable to find any relevant i...' from http://172.17.117.23:1235/tts
2025-05-27 19:46:38,016 - DanzarVLM - INFO - [AudioService] TTS audio received (length: 398380 bytes).
2025-05-27 19:46:38,016 - DanzarVLM - INFO - Conversational response sent to queue: "I apologize, but I'm unable to find any relevant information about that topic. Would you like to try..."
[aist#0:0/pcm_s16le @ 0x5630c421a600] Guessed Channel Layout: mono
